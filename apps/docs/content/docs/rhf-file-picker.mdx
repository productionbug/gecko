---
title: RHFFilePicker
description: Advanced file picker with drag-and-drop support integrated with React Hook Form
---

import { RHFFilePicker } from '@productionbug/gecko';
import {
  BasicRHFFilePickerExample,
  WithValidationExample,
  RemoveDuplicatesExample,
  KeepOldFilesExample,
  CustomRenderExample,
  WithCallbacksExample,
  CompleteFormExample
} from '@/components/examples/rhf-file-picker-examples';

# RHFFilePicker

An advanced file picker component with drag-and-drop support, directory selection, and duplicate detection integrated with React Hook Form. Perfect for uploading multiple files or entire directories.

## Installation

```tsx
import { RHFFilePicker } from '@productionbug/gecko';
```

## Basic Usage

<Preview>
  <BasicRHFFilePickerExample />
</Preview>

```tsx
import { useForm, FormProvider } from 'react-hook-form';
import { RHFFilePicker } from '@productionbug/gecko';

function Example() {
  const methods = useForm({
    defaultValues: {
      basicFiles: []
    }
  });

  return (
    <FormProvider {...methods}>
      <RHFFilePicker name="basicFiles" />
    </FormProvider>
  );
}
```

## Props API

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `name` | `string` | - | Field name (required) |
| `control` | `Control` | Auto-injected | Optional: Pass explicitly for nested forms or custom form context |
| `accept` | `string` | `*` | File types to accept (e.g., "image/*", ".pdf") |
| `removeDuplicates` | `boolean` | `false` | Automatically remove duplicate files |
| `keepOldFiles` | `boolean` | `false` | Keep previously selected files when adding new ones |
| `transform` | `(files) => files` | - | Transform files before setting them |
| `onChange` | `(files, newFiles) => void` | - | Callback when files change |
| `onError` | `(error) => void` | - | Callback when an error occurs |
| `render` | `Function` | - | Custom render function with access to picker state |

## Examples

### With Validation (Zod)

<Preview>
  <WithValidationExample />
</Preview>

```tsx
import { useForm, FormProvider } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { RHFFilePicker, RHFInputGroup, Button } from '@productionbug/gecko';

const schema = z.object({
  validationImages: z
    .array(z.custom<File>())
    .min(1, 'At least one image is required')
    .max(10, 'Maximum 10 images allowed')
    .refine(
      (files) => files.every((file) => file.size <= 5000000),
      'Each file must be less than 5MB'
    )
    .refine(
      (files) => files.every((file) => ['image/jpeg', 'image/png', 'image/webp'].includes(file.type)),
      'Only JPEG, PNG, and WebP images are allowed'
    )
});

function Example() {
  const methods = useForm({
    resolver: zodResolver(schema),
    mode: 'onBlur',
    defaultValues: {
      validationImages: []
    }
  });

  return (
    <FormProvider {...methods}>
      <form onSubmit={methods.handleSubmit(console.log)}>
        <RHFInputGroup label="Product Images" required>
          <RHFFilePicker name="validationImages" accept="image/*" />
        </RHFInputGroup>
        <Button type="submit">Upload Images</Button>
      </form>
    </FormProvider>
  );
}
```

### Remove Duplicates

<Preview>
  <RemoveDuplicatesExample />
</Preview>

```tsx
<RHFFilePicker name="uniqueDocuments" removeDuplicates accept=".pdf,.doc,.docx" />
```

### Keep Old Files

Accumulate files across multiple selections:

<Preview>
  <KeepOldFilesExample />
</Preview>

```tsx
<RHFFilePicker name="accumulatedFiles" keepOldFiles />
```

### Custom Render with Image Grid

<Preview>
  <CustomRenderExample />
</Preview>

```tsx
import { classNames } from '@productionbug/gecko/utils';

<RHFFilePicker
  name="customImages"
  accept="image/*"
  render={({
    dropzoneRef,
    dragging,
    loading,
    field: { value: files },
    openFilePicker,
  }) => (
    <div
      ref={dropzoneRef}
      className={classNames(
        'relative flex h-[500px] w-full flex-col rounded border-2 border-dashed',
        loading && 'cursor-wait',
        dragging ? 'border-blue-400' : 'border-gray-300'
      )}
    >
      {!!files?.length && (
        <div className="w-full flex-1 overflow-y-auto grid grid-cols-3 gap-3 p-2 pb-16">
          {files.map((file) => (
            <img
              key={file.preview}
              src={file.preview}
              alt={file.name}
              className="aspect-square w-full h-20 object-contain rounded border"
            />
          ))}
        </div>
      )}

      <div className="absolute bottom-0 left-0 right-0 border bg-white p-1.5 flex gap-2">
        <Button
          variant="outlined"
          className="flex-1"
          onClick={() => openFilePicker()}
        >
          Select Images
        </Button>

        <Button
          className="flex-1"
          onClick={() => openFilePicker({ directory: true })}
        >
          Select Directory
        </Button>
      </div>

      {!loading && !files?.length && (
        <div className="flex flex-1 items-center justify-center">
          <span>Drop images here or click buttons below</span>
        </div>
      )}

      {loading && (
        <div className="absolute inset-0 flex items-center justify-center bg-white bg-opacity-50">
          Loading...
        </div>
      )}
    </div>
  )}
/>
```

### With Callbacks

<Preview>
  <WithCallbacksExample />
</Preview>

```tsx
const handleChange = (files: FilePickerFile[], newFiles: FilePickerFile[]) => {
  console.log('All files:', files);
  console.log('New files:', newFiles);
};

const handleError = (error: Error) => {
  console.error('File picker error:', error);
  alert(`Error: ${error.message}`);
};

<RHFFilePicker
  name="callbackFiles"
  onChange={handleChange}
  onError={handleError}
/>
```

### Complete Form Example

<Preview>
  <CompleteFormExample />
</Preview>

```tsx
import { useForm, FormProvider } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { RHFFilePicker, RHFInputGroup, Button } from '@productionbug/gecko';

const schema = z.object({
  projectFiles: z
    .array(z.custom<File>())
    .min(1, 'At least one file is required')
    .refine(
      (files) => files.every((file) => file.size <= 10000000),
      'Each file must be less than 10MB'
    ),
  screenshots: z
    .array(z.custom<File>())
    .min(3, 'At least 3 screenshots are required')
    .max(10, 'Maximum 10 screenshots allowed')
    .refine(
      (files) => files.every((file) => ['image/jpeg', 'image/png', 'image/webp'].includes(file.type)),
      'Only JPEG, PNG, and WebP images are allowed'
    )
});

function ProjectForm() {
  const methods = useForm({
    resolver: zodResolver(schema),
    mode: 'onBlur',
    defaultValues: {
      projectFiles: [],
      screenshots: []
    }
  });

  return (
    <FormProvider {...methods}>
      <form onSubmit={methods.handleSubmit(console.log)}>
        <RHFInputGroup label="Project Files" required>
          <RHFFilePicker name="projectFiles" removeDuplicates />
        </RHFInputGroup>

        <RHFInputGroup label="Screenshots" required>
          <RHFFilePicker name="screenshots" accept="image/*" removeDuplicates />
        </RHFInputGroup>

        <Button type="submit">Submit Project</Button>
      </form>
    </FormProvider>
  );
}
```

## File Properties

Each file in the picker has these properties:

```typescript
interface FilePickerFile extends File {
  preview: string;
  path: string;
  editableName: string;
}
```

- `preview`: Object URL for displaying file content
- `path`: File system path (from directory picker or webkitRelativePath)
- `editableName`: Editable name property (since File.name is read-only)

## Drag and Drop

RHFFilePicker automatically handles drag-and-drop:

1. Drag files over the dropzone
2. The `dragging` state becomes `true`
3. Drop files to add them
4. Files are processed and previews are created

Access drag state in custom render:

```tsx
render={({ dragging, dropzoneRef }) => (
  <div
    ref={dropzoneRef}
    className={dragging ? 'border-blue-400' : 'border-gray-300'}
  >
    Drop files here
  </div>
)}
```

## Directory Selection

Select entire directories using the `openFilePicker` function:

```tsx
render={({ openFilePicker }) => (
  <Button onClick={() => openFilePicker({ directory: true })}>
    Select Directory
  </Button>
)}
```

This preserves the directory structure in the `path` property of each file.

## Duplicate Detection

When `removeDuplicates={true}`:

- Files with identical names and sizes are considered duplicates
- Only the first occurrence is kept
- Duplicates are automatically filtered out

Files also have a `duplicatedWith` property containing an array of files they duplicate.

## File Transformation

Transform files before they're set in the form:

```tsx
const transform = async (files: FilePickerFile[]) => {
  return files.map(file => {
    file.editableName = file.name.toLowerCase();
    return file;
  });
};

<RHFFilePicker name="files" transform={transform} />
```

## File Types

The `accept` prop accepts standard file input values:

```tsx
accept="image/*"
accept=".pdf"
accept=".jpg,.jpeg,.png"
accept="video/*"
accept=".doc,.docx,application/pdf"
```

## Validation with Zod

Validate file arrays with Zod:

```tsx
z.array(z.custom<File>())
  .min(1, 'At least one file required')
  .max(10, 'Maximum 10 files')
  .refine(
    (files) => files.every((file) => file.size <= 5000000),
    'Each file must be less than 5MB'
  )
  .refine(
    (files) => files.every((file) =>
      ['image/jpeg', 'image/png'].includes(file.type)
    ),
    'Only JPEG and PNG allowed'
  )
```

## Error States

RHFFilePicker automatically displays error states:
- Red border via `GeckoUIRHFFilePicker--error` CSS class when validation fails
- Use with [RHFInputGroup](/docs/rhf-input-group) for complete error display

```tsx
<RHFInputGroup label="Upload Files" required>
  <RHFFilePicker name="files" />
</RHFInputGroup>
```

**Tip**: Use `mode: 'onBlur'` to validate after file selection:

```tsx
const methods = useForm({
  resolver: zodResolver(schema),
  mode: 'onBlur'
});
```

## Loading States

The picker automatically manages loading states:

```tsx
render={({ loading }) => (
  loading ? <Spinner /> : <div>Ready to upload</div>
)}
```

Loading occurs during:
- File processing
- Preview URL generation
- Transform function execution

## Custom Rendering

The `render` prop provides access to picker state:

```tsx
render={({
  dropzoneRef,
  dragging,
  loading,
  openFilePicker,
  files,
  field,
  fieldState,
  formState
}) => (
  <div ref={dropzoneRef}>
    {/* Custom UI */}
  </div>
)}
```

**Important**: Always attach `dropzoneRef` to your dropzone element for drag-and-drop to work.

## Accessibility

- Keyboard navigable buttons
- Screen reader compatible
- Proper ARIA attributes for loading and error states
- Focus management for file picker dialogs

## Performance Tips

1. Use `removeDuplicates` to prevent duplicate uploads
2. Set file size limits in validation
3. Limit file count with Zod `.max()`
4. Use `accept` to restrict file types before selection

## Related Components

- [RHFFileInput](/docs/rhf-file-input) - Simple file input for single/multiple files
- [RHFInputGroup](/docs/rhf-input-group) - Label + input + error wrapper
- [RHFError](/docs/rhf-error) - Error message display
